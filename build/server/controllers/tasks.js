// Generated by CoffeeScript 1.9.2
var Task, reindexer;

Task = require('../models/tasky');

reindexer = require('../lib/reindexer');

module.exports.reindexationMiddleware = function(req, res, next) {
  if (reindexer.isReindexing()) {
    return res.status(400).send({
      error: "reindexation is occuring, retry later"
    });
  } else {
    return next();
  }
};

module.exports.all = function(req, res) {
  return Task.all(function(err, tasks) {
    return res.status(200).send([]);
  });
};

module.exports.create = function(req, res) {
  return Task.create(req.body, function(err, task) {
    if (err != null) {
      return res.status(500).send("An error occured while creating a task -- " + err);
    } else {
      return res.status(201).send(task);
    }
  });
};

module.exports.fetch = function(req, res, next, id) {
  return Task.find(id, function(err, task) {
    if ((err != null) || (task == null)) {
      return res.status(404).send({
        error: "Task not found"
      });
    } else {
      req.task = task;
      return next();
    }
  });
};

module.exports.update = function(req, res) {
  return req.task.updateAttributes(req.body, function(err, task) {
    if (err != null) {
      return res.status(500).send("An error occured while updating a task -- " + err);
    } else {
      return res.status(200).send(task);
    }
  });
};

module.exports["delete"] = function(req, res) {
  return req.task.destroy(function(err) {
    if (err != null) {
      return res.status(500).send("An error occured while deleting a task -- " + err);
    } else {
      return res.status(204).send();
    }
  });
};

module.exports.reindex = function(req, res) {
  return reindexer.reindex(function(err, tasks) {
    if (err != null) {
      return res.status(500).send({
        error: err
      });
    } else {
      return res.status(200).send(tasks);
    }
  });
};
